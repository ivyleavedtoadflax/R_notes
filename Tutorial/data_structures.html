<html>

<head>
<style type="text/css">
.knitr.inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
},
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0em 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.rimage.left {
  text-align: left;
}
.rimage.right {
  text-align: right;
}
.rimage.center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
<title>Getting Started with R - Data structures</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css">

</head>

<body>

<h1>Data structures</h1>

<h2>Long and wide data</h2>

<p>The astute among you may have noticed, that although I have recommended that you save your data in 'long' format, all the datasets loaded from R and elsewhere, so far, have been in 'wide' rather than 'long' format.</p>

<p>What exactly do we mean by the terms 'long' and 'wide'? And why does it really matter. To give you an example, we'll simulate some data to practice on. This data consist

<p>In this example we will create our own dataset by randomly generating values along a uniform distribution. We'll use a soil science example. We simulate data for an experiment in whcih 120 samples of bulk density <tt>bd</tt>, and organic carbon <tt>oc</tt> were collected in 3 replicate <tt>blocks</tt>, 4 <tt>treatments</tt>, and at 6 <tt>depths</tt>.</p>





<div class="chunk" id="unnamed-chunk-2"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">set.seed</span><span class="hl std">(</span><span class="hl num">1337</span><span class="hl std">)</span>
<span class="hl com"># For brevity these commands have been called lazily!</span>
<span class="hl std">oc_data</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">data.frame</span><span class="hl std">(</span>
     <span class="hl kwc">block</span> <span class="hl std">=</span> <span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">3</span><span class="hl std">,</span><span class="hl kwc">each</span><span class="hl std">=</span><span class="hl num">6</span><span class="hl std">),</span><span class="hl kwc">length.out</span><span class="hl std">=</span><span class="hl num">120</span><span class="hl std">),</span>
     <span class="hl kwc">treatment</span> <span class="hl std">=</span> <span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(LETTERS[</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">4</span><span class="hl std">],</span><span class="hl kwc">length</span><span class="hl std">=</span><span class="hl num">24</span><span class="hl std">),</span><span class="hl kwc">length.out</span><span class="hl std">=</span><span class="hl num">120</span><span class="hl std">),</span>
     <span class="hl kwc">depth</span> <span class="hl std">=</span> <span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">6</span><span class="hl std">,</span><span class="hl kwc">each</span><span class="hl std">=</span><span class="hl num">20</span><span class="hl std">),</span>
     <span class="hl kwc">oc</span> <span class="hl std">=</span> <span class="hl kwd">rev</span><span class="hl std">(</span><span class="hl kwd">sort</span><span class="hl std">(</span><span class="hl kwd">abs</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">5</span><span class="hl std">,</span><span class="hl num">3</span><span class="hl std">,</span><span class="hl num">2.2</span><span class="hl std">,</span><span class="hl num">1.8</span><span class="hl std">,</span><span class="hl num">1.2</span><span class="hl std">,</span><span class="hl num">1</span><span class="hl std">)</span><span class="hl opt">+</span><span class="hl kwd">runif</span><span class="hl std">(</span><span class="hl num">120</span><span class="hl std">,</span><span class="hl kwc">max</span><span class="hl std">=</span><span class="hl num">1.5</span><span class="hl std">,</span><span class="hl kwc">min</span><span class="hl std">=</span><span class="hl num">1.5</span><span class="hl std">)</span><span class="hl opt">+</span><span class="hl kwd">rexp</span><span class="hl std">(</span><span class="hl num">120</span><span class="hl std">,</span><span class="hl kwc">rate</span><span class="hl std">=</span><span class="hl num">10</span><span class="hl std">)))),</span>
     <span class="hl kwc">bd</span> <span class="hl std">=</span> <span class="hl kwd">sort</span><span class="hl std">(</span><span class="hl kwd">runif</span><span class="hl std">(</span><span class="hl num">120</span><span class="hl std">,</span><span class="hl kwc">min</span><span class="hl std">=</span><span class="hl num">0.85</span><span class="hl std">,</span><span class="hl kwc">max</span><span class="hl std">=</span><span class="hl num">1.6</span><span class="hl std">))</span>
     <span class="hl std">)</span>
<span class="hl kwd">head</span><span class="hl std">(oc_data)</span>
</pre></div>
<div class="output"><pre class="knitr r">##   block treatment depth    oc     bd
## 1     1         A     1 7.100 0.8576
## 2     1         B     1 6.938 0.8656
## 3     1         C     1 6.799 0.8763
## 4     1         D     1 6.743 0.8847
## 5     1         A     1 6.685 0.8908
## 6     1         B     1 6.672 0.8954
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">str</span><span class="hl std">(oc_data)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 'data.frame':	120 obs. of  5 variables:
##  $ block    : int  1 1 1 1 1 1 2 2 2 2 ...
##  $ treatment: Factor w/ 4 levels "A","B","C","D": 1 2 3 4 1 2 3 4 1 2 ...
##  $ depth    : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ oc       : num  7.1 6.94 6.8 6.74 6.68 ...
##  $ bd       : num  0.858 0.866 0.876 0.885 0.891 ...
</pre></div>
<div class="source"><pre class="knitr r">
</pre></div>
</div></div>


<p>This makes for a reasonably complicated factorial experiment. If we want to get somethign sensible from it, we need to convert it to long format first. We use the package <tt>reshape</tt> to do this...</p>





<div class="chunk" id="unnamed-chunk-4"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com">## </span>
<span class="hl kwd">require</span><span class="hl std">(reshape)</span>
<span class="hl std">oc_data_m</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">melt</span><span class="hl std">(</span>
     <span class="hl std">oc_data,</span>
     <span class="hl kwc">id.vars</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">3</span><span class="hl std">,</span>
     <span class="hl kwc">measure.vars</span> <span class="hl std">=</span> <span class="hl num">4</span><span class="hl opt">:</span><span class="hl num">5</span>
     <span class="hl std">)</span>
<span class="hl kwd">head</span><span class="hl std">(oc_data_m)</span>
</pre></div>
<div class="output"><pre class="knitr r">##   block treatment depth variable value
## 1     1         A     1       oc 7.100
## 2     1         B     1       oc 6.938
## 3     1         C     1       oc 6.799
## 4     1         D     1       oc 6.743
## 5     1         A     1       oc 6.685
## 6     1         B     1       oc 6.672
</pre></div>
<div class="source"><pre class="knitr r">
# I won't run this command for brevity, but you should, just to check the data:

#oc_data_m

</pre></div>
</div></div>


<p>Suppose we want to see the average <tt>bd</tt> and <tt>oc</tt> for each treatment, each depth, and a combination of treatment and depth...</p>

<div class="chunk" id="unnamed-chunk-5"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">cast</span><span class="hl std">(</span>
     <span class="hl std">oc_data_m,</span>
     <span class="hl std">treatment</span> <span class="hl opt">~</span> <span class="hl std">variable,</span>
     <span class="hl std">mean</span>
     <span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">##   treatment    oc    bd
## 1         A 3.985 1.209
## 2         B 3.965 1.213
## 3         C 3.949 1.219
## 4         D 3.939 1.226
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># If we want the standard deviation as well as the mean, we can use:</span>
<span class="hl kwd">cast</span><span class="hl std">(</span>
     <span class="hl std">oc_data_m,</span>
     <span class="hl std">depth</span> <span class="hl opt">~</span> <span class="hl std">variable,</span>
     <span class="hl kwd">c</span><span class="hl std">(mean, sd)</span>
     <span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">##   depth oc_mean   oc_sd bd_mean   bd_sd
## 1     1   6.638 0.15619  0.9253 0.04580
## 2     2   4.572 0.08014  1.0349 0.03132
## 3     3   3.793 0.07575  1.1375 0.02505
## 4     4   3.387 0.06998  1.2649 0.05470
## 5     5   2.774 0.06469  1.3927 0.02901
## 6     6   2.593 0.05850  1.5452 0.03725
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># We can even apply our own custom functions - for example the upper and lower </span>
<span class="hl com"># 95% confidence interval</span>
<span class="hl std">uci95</span> <span class="hl kwb">&lt;-</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">) {</span>
     <span class="hl kwd">mean</span><span class="hl std">(x)</span> <span class="hl opt">+</span> <span class="hl kwd">qt</span><span class="hl std">(</span><span class="hl num">0.975</span><span class="hl std">,</span><span class="hl kwc">df</span> <span class="hl std">=</span> <span class="hl kwd">length</span><span class="hl std">(x)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">)</span> <span class="hl opt">*</span> <span class="hl kwd">sd</span><span class="hl std">(x)</span> <span class="hl opt">/</span> <span class="hl kwd">sqrt</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(x))</span>
<span class="hl std">}</span>
<span class="hl std">lci95</span> <span class="hl kwb">&lt;-</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">) {</span>
     <span class="hl kwd">mean</span><span class="hl std">(x)</span> <span class="hl opt">-</span> <span class="hl kwd">qt</span><span class="hl std">(</span><span class="hl num">0.975</span><span class="hl std">,</span><span class="hl kwc">df</span> <span class="hl std">=</span> <span class="hl kwd">length</span><span class="hl std">(x)</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">)</span> <span class="hl opt">*</span> <span class="hl kwd">sd</span><span class="hl std">(x)</span> <span class="hl opt">/</span> <span class="hl kwd">sqrt</span><span class="hl std">(</span><span class="hl kwd">length</span><span class="hl std">(x))</span>
<span class="hl std">}</span>
<span class="hl com"># and if we are only interested in one variable, and teh top three depths for</span>
<span class="hl com"># instance...., we subset the data</span>
<span class="hl kwd">cast</span><span class="hl std">(</span>
     <span class="hl kwd">subset</span><span class="hl std">(</span>
          <span class="hl std">oc_data_m,</span>
          <span class="hl std">variable</span> <span class="hl opt">==</span> <span class="hl str">&quot;oc&quot;</span> <span class="hl opt">&amp;</span> <span class="hl std">depth</span> <span class="hl opt">&lt;</span> <span class="hl num">4</span><span class="hl std">),</span>
     <span class="hl std">treatment</span> <span class="hl opt">+</span> <span class="hl std">depth</span> <span class="hl opt">~</span> <span class="hl std">variable,</span>
     <span class="hl kwd">c</span><span class="hl std">(mean, sd, lci95, uci95)</span>
     <span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">##    treatment depth oc_mean   oc_sd oc_lci95 oc_uci95
## 1          A     1   6.696 0.23571    6.403    6.989
## 2          A     2   4.597 0.10780    4.463    4.731
## 3          A     3   3.807 0.08764    3.698    3.915
## 4          B     1   6.647 0.17354    6.431    6.862
## 5          B     2   4.575 0.08018    4.476    4.675
## 6          B     3   3.804 0.08679    3.696    3.912
## 7          C     1   6.613 0.11689    6.468    6.758
## 8          C     2   4.561 0.07558    4.467    4.655
## 9          C     3   3.789 0.08236    3.687    3.891
## 10         D     1   6.597 0.09673    6.477    6.717
## 11         D     2   4.553 0.07322    4.462    4.644
## 12         D     3   3.774 0.06638    3.691    3.856
</pre></div>
<div class="source"><pre class="knitr r">
</pre></div>
</div></div>


<p>It's good practice to start using long data early in your <tt>R</tt> career, as many of the more powerful visuliation and analysis packages require it. With the excellent <tt>ggplot</tt> package, for instance, it is possible to produce complex graphics from long data very simply</p>

<!--<!--begin.rcode,"data_structures-1",fig.width=15,tidy=FALSE,fig.height=10

require(ggplot2)

ggplot(
     oc_data_m,
     aes(
          x = factor(depth),
          y = value,
          group = factor(depth),
          fill = variable
          )
     )+#geom_boxplot(fill="gray")+
     geom_jitter(shape=21,size=3.5,alpha=0.5)+
     facet_grid(variable~treatment,scale="free")+
     theme_bw()+xlab("Sampling Depth")

end.rcode-->


</body>

</html>
